<html>
<template id="resale-card-template">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">

    <!-- Styles -->
    <style>
        :host {
            background: #FAFAFA;
            border-radius: 10px;
            display: inline-block;
            height: 140px;
            margin: 2px;
            padding: 2px;
            width: 99%;
        }

        :host > .component {
            border-radius: 10px;
            display: inline-block;
            height: 130px;
            margin: 2px;
            padding: 2px;
            width: 130px;

            box-shadow: 0 8px 10px 1px rgba(0, 0, 0, 0.14),
                0 3px 14px 2px rgba(0, 0, 0, 0.12),
                0 5px 5px -3px rgba(0, 0, 0, 0.4);
        }

        :host > #resale-desc > .title {
            text-align: center;
            font-size: 12px;
        }

        :host > #resale-desc > img {
            display: block;
            height: 100px;
            margin: auto;
        }

        :host > #resale-desc > .link {
            display: block;
            font-size: 12px;
            text-align: center;
        }
    </style>

    <!-- Content -->
    <div id="resale-desc" class="component">
        <div class="title"></div>
        <img class="image" src="">
        <a class="link" href="" target="_blank"><span class="id"></span></a>
    </div>

    <div id="resale-price" class="component">
        <div class="price"></div>
    </div>

    <script src="/components/jquery/dist/jquery.min.js" defer></script>
</template>

<!-- Scripts -->
<script>
    (function () {
        const currentDoc = document.currentScript.ownerDocument;

        class ResaleCard extends HTMLElement {

            constructor() {
                const template = currentDoc.querySelector('#resale-card-template');

                super();

                this.attachShadow({ mode: 'open' });
                this.shadowRoot.appendChild(template.content.cloneNode(true));
            }

            connectedCallback() {
                const resaleId = this.getAttribute('resale-id');
                const self = this;
                const storeUri = this.getAttribute('store-uri');

                fetch(`${storeUri}/resales/${resaleId}`)
                    .then((response) => response.text())
                    .then((responseText) => {
                        this.render(JSON.parse(responseText));
                    })
                    .catch((err) => {
                        // todo - make card display error (maybe attribute error)
                        console.log(err);
                    });
            }

            render(data) {
                // desc
                var $desc = $('#resale-desc', this.shadowRoot);
                $desc.find('.link').attr('href', data.link);
                $desc.find('.id').text(data.eBayId);
                $desc.find('.image').attr('src', data.images[0]);
                $desc.find('.title').text(data.title || 'Title');

                // price
                var $price = $('#resale-price', this.shadowRoot);
                $price.find('.price').text(data.price);
            }

        }

        window.customElements.define('resale-card', ResaleCard);
    }());
</script>
</html>
